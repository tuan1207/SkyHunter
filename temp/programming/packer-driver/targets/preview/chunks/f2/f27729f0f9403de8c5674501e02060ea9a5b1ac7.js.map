{"version":3,"sources":["file:///D:/Cocos%20Creator/Sky-Hunter/NewProject/assets/scripts/Boss.ts"],"names":["_decorator","Component","Collider2D","Contact2DType","math","Vec3","tween","Prefab","instantiate","macro","Animation","ccclass","property","Boss","randomPosition","bulletCont","listPos","start","collider","getComponent","on","BEGIN_CONTACT","onBeginContact","END_CONTACT","onEndContact","moveRandom","schedule","spawnBullet","REPEAT_FOREVER","update","deltaTime","randomX","random","randomY","distance","node","position","duration","speed","to","call","selfCollider","otherCollider","contact","name","startsWith","scheduleOnce","push","currentHealth","updateHealthBar","countContact","length","self","destroy","GameCtrl","instance","healthBoss","active","spawnEnabled","checkSpawnFunc","spawnFunc2","i","listBulletB1","enemyPre","prefabInstance","parent","setWorldPosition","worldPosition","listBulletB3","j","endsWith","x","y","z","progress","maxHealth"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Collider2D, Contact2DType, math, Vec3, tween, IPhysics2DContact, Prefab, instantiate, macro, Animation, Scene } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Boss')\r\nexport class Boss extends Component {\r\n    @property(Prefab)\r\n    public listBulletB1: Prefab [] = [];\r\n    @property(Prefab)\r\n    public listBulletB3: Prefab [] = [];\r\n    @property(Animation)\r\n    public laserBullet: Animation = null;\r\n    @property\r\n    speed: number = 100;\r\n    public randomPosition;\r\n    public bulletCont = [];\r\n    listPos = [\r\n        new Vec3(590, 360),//turn 1, 3, 5, 7\r\n        new Vec3(690, 360),//turn 2\r\n    ];\r\n    start() {\r\n        let collider = this.getComponent(Collider2D);\r\n        if (collider) {\r\n            collider.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\r\n            collider.on(Contact2DType.END_CONTACT, this.onEndContact, this);\r\n        }\r\n        this.moveRandom();\r\n        this.schedule(this.spawnBullet, 2.5, macro.REPEAT_FOREVER, 0);\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        \r\n    }\r\n    moveRandom() {\r\n        const randomX = math.random() * (0 - 1000) + 500;\r\n        const randomY = math.random() * (200 - 600) + 200;\r\n        this.randomPosition = new Vec3(randomX, randomY);\r\n\r\n        const distance = Vec3.distance(this.node.position, this.randomPosition);\r\n        const duration = distance / this.speed;\r\n\r\n        tween(this.node)\r\n            .to(duration, { position: this.randomPosition })\r\n            .call(() => {\r\n                this.moveRandom();\r\n            })\r\n            .start();\r\n    }\r\n    onBeginContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null){\r\n        if(otherCollider.node.name.startsWith('bullet') || otherCollider.node.name.startsWith('rocket')){\r\n            this.scheduleOnce(() => {this.bulletCont.push(otherCollider)});\r\n            if(this.node.name === 'boss001'){\r\n                this.currentHealth -= 2;\r\n                if (this.currentHealth <= 0) {\r\n                    this.currentHealth = 0;\r\n                }\r\n                this.updateHealthBar();\r\n                if(this.countContact.length == 50){\r\n                this.scheduleOnce(() => {   self?.destroy()     });\r\n                GameCtrl.instance.healthBoss[0].node.active = false;\r\n                this.spawnEnabled = false;\r\n                GameCtrl.instance.checkSpawnFunc(GameCtrl.instance.spawnFunc2);\r\n                    }\r\n                if(this.bulletCont.length === 50){\r\n                    this.scheduleOnce(() => {selfCollider.node.destroy()});\r\n                    \r\n                }\r\n            }\r\n            if(this.node.name === 'boss002'){\r\n                if(this.bulletCont.length === 100){\r\n                    this.scheduleOnce(() => {selfCollider.node.destroy()});\r\n                }\r\n            }\r\n            if(this.node.name === 'boss003'){\r\n                if(this.bulletCont.length === 150){\r\n                    this.scheduleOnce(() => {selfCollider.node.destroy()});\r\n                }\r\n            }\r\n            this.scheduleOnce(() => {otherCollider.node.destroy()});\r\n        }\r\n    }\r\n    onEndContact(selfCollider: Collider2D, otherCollider: Collider2D, contact: IPhysics2DContact | null){\r\n\r\n    }\r\n    spawnBullet(){\r\n        if(this.node.name === 'boss001'){\r\n            for(let i = 0; i < this.listBulletB1.length; i++){\r\n            let enemyPre = this.listBulletB1[i];\r\n            let prefabInstance = instantiate(enemyPre);\r\n            prefabInstance.parent = this.node.parent;\r\n            prefabInstance.setWorldPosition(this.node.worldPosition);\r\n            }\r\n        }\r\n        if(this.node.name === 'boss002'){\r\n            return;\r\n        }\r\n        if(this.node.name === 'boss003'){\r\n            for( let i = 0; i < this.listBulletB3.length; i++){\r\n                for(let j = 0; j < 5; j++){\r\n                    let enemyPre = this.listBulletB3[i];\r\n                    let prefabInstance = instantiate(enemyPre);\r\n                    prefabInstance.parent = this.node.parent;\r\n    \r\n                    if(enemyPre.name.endsWith('_0') || enemyPre.name.endsWith('_1') || enemyPre.name.endsWith('_2') || enemyPre.name.endsWith('_3') || enemyPre.name.endsWith('_4')){\r\n                        prefabInstance.setWorldPosition(this.node.worldPosition.x - 105, this.node.worldPosition.y - 65, this.node.worldPosition.z);\r\n                    }\r\n                    if(enemyPre.name.endsWith('_5') || enemyPre.name.endsWith('_6') || enemyPre.name.endsWith('_7') || enemyPre.name.endsWith('_8') || enemyPre.name.endsWith('_9')){\r\n                        prefabInstance.setWorldPosition(this.node.worldPosition.x + 105, this.node.worldPosition.y - 65, this.node.worldPosition.z);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    updateHealthBar() {\r\n        if (GameCtrl.instance.healthBoss[0]) {\r\n            GameCtrl.instance.healthBoss[0].progress = this.currentHealth / this.maxHealth;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}