{"version":3,"sources":["file:///D:/Cocos%20Creator/Sky-Hunter/NewProject/assets/scripts/JoyStick.ts"],"names":["_decorator","Component","math","misc","Node","UITransform","Vec3","ccclass","property","JoyStick","Pos","VecY","angleDeg","moveSpeed","start","update","dt","onLoad","instance","Stick","setPosition","node","on","EventType","TOUCH_MOVE","onStickMove","TOUCH_END","onStickEnd","TOUCH_CANCEL","event","wp","getUILocation","getComponent","convertToNodeSpaceAR","x","y","stickMag","length","maxR","angle","distance","position","radian","degreesToRadians","deltaX","Math","cos","deltaY","sin","posX","plane","posY","posPlane","countAngleStick"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, math, misc, Node, UITransform, Vec3 } from 'cc';\r\nimport { Plane } from './Plane';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('JoyStick')\r\nexport class JoyStick extends Component {\r\n    static instance: JoyStick;\r\n    @property(Node)\r\n    public Stick: Node = null;\r\n    @property\r\n    public maxR: number = 100;\r\n    public Pos;\r\n    public VecY = new Vec3(0, 0, 0);\r\n    public angleDeg;\r\n    @property(Node)\r\n    public plane: Node = null;\r\n    public moveSpeed: number = 200;\r\n    \r\n    start() {\r\n\r\n    }\r\n\r\n    update(dt: number) {\r\n        \r\n    }\r\n    protected onLoad(): void {\r\n        JoyStick.instance = this;\r\n        \r\n        this.Stick.setPosition(new Vec3(0, 0));\r\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onStickMove, this);\r\n        this.node.on(Node.EventType.TOUCH_END, this.onStickEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onStickEnd, this);\r\n\r\n    }\r\n    onStickMove(event: EventTouch, dt: number){\r\n        let wp = event.getUILocation();\r\n        this.Pos = this.node.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wp.x, wp.y));\r\n        let stickMag = this.Pos.length();\r\n        if(stickMag <= 0){\r\n            return;\r\n        }\r\n        if(stickMag > this.maxR){\r\n            this.Pos.x = this.Pos.x * this.maxR/stickMag;\r\n            this.Pos.y = this.Pos.y * this.maxR/stickMag;\r\n        }\r\n        this.Stick.setPosition(this.Pos);\r\n\r\n        let angle = this.Stick.angle; // Góc quay của joystick\r\n        let distance = math.Vec3.distance(this.VecY, this.Stick.position); // Khoảng cách từ tâm của joystick đến điểm đang chạm\r\n        \r\n        // Tính toán vector di chuyển dựa trên góc và khoảng cách\r\n        let radian = misc.degreesToRadians(angle); // Chuyển đổi góc sang radian\r\n        let deltaX = Math.cos(radian) * distance; // Tính toán delta X\r\n        let deltaY = Math.sin(radian) * distance; // Tính toán delta Y\r\n        \r\n        // Di chuyển đối tượng\r\n        let posX = this.plane.position.x;\r\n        let posY = this.plane.position.y;\r\n\r\n        posX += deltaX * this.moveSpeed * dt;\r\n        posY += deltaY * this.moveSpeed * dt;\r\n        let posPlane = new Vec3(posX, posY);\r\n        this.plane.setPosition(posPlane);\r\n    }\r\n    onStickEnd(event: EventTouch){\r\n        this.Stick.setPosition(new Vec3(0, 0));\r\n    }\r\n    countAngleStick(event, dt: number){\r\n        \r\n    }\r\n    \r\n}\r\n\r\n\r\n"]}