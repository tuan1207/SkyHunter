{"version":3,"sources":["file:///D:/Cocos%20Creator/Sky-Hunter/NewProject/assets/scripts/JoyStick.ts"],"names":["_decorator","Component","math","Node","UITransform","Vec3","ccclass","property","JoyStick","Pos","VecY","angleDeg","moveSpeed","start","update","dt","onLoad","instance","node","on","EventType","TOUCH_START","onStickStart","TOUCH_MOVE","onStickMove","TOUCH_END","onStickEnd","TOUCH_CANCEL","event","wp","getUILocation","getComponent","convertToNodeSpaceAR","x","y","stickMag","length","maxR","Stick","setPosition","direction","clone","subtract","normalize","distance","lastDirection","posX","plane","position","posY"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, math, misc, Node, UITransform, Vec3 } from 'cc';\r\nimport { Plane } from './Plane';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('JoyStick')\r\nexport class JoyStick extends Component {\r\n    static instance: JoyStick;\r\n    @property(Node)\r\n    public joyStick: Node = null;\r\n    @property(Node)\r\n    public Stick: Node = null;\r\n    @property\r\n    public maxR: number = 100;\r\n    public Pos;\r\n    public VecY = new Vec3(0, 0, 0);\r\n    public angleDeg;\r\n    @property(Node)\r\n    public plane: Node = null;\r\n    public moveSpeed: number = 200;\r\n    \r\n    start() {\r\n\r\n    }\r\n\r\n    update(dt: number) {\r\n        \r\n    }\r\n    protected onLoad(): void {\r\n        JoyStick.instance = this;\r\n        \r\n        this.node.on(Node.EventType.TOUCH_START, this.onStickStart, this);\r\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onStickMove, this);\r\n        this.node.on(Node.EventType.TOUCH_END, this.onStickEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onStickEnd, this);\r\n\r\n    }\r\n    onStickStart(event: EventTouch){\r\n        // let wp = event.getUILocation();\r\n        // this.Pos = this.node.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wp.x, wp.y));\r\n        // this.joyStick.active = true;\r\n        // this.joyStick.setPosition(this.Pos);\r\n    }\r\n    onStickMove(event: EventTouch, dt: number){\r\n        let wp = event.getUILocation();\r\n    this.Pos = this.node.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wp.x, wp.y));\r\n    let stickMag = this.Pos.length();\r\n    \r\n    if (stickMag <= 0) {\r\n        return;\r\n    }\r\n    \r\n    if (stickMag > this.maxR) {\r\n        this.Pos.x = this.Pos.x * this.maxR / stickMag;\r\n        this.Pos.y = this.Pos.y * this.maxR / stickMag;\r\n    }\r\n    \r\n    this.Stick.setPosition(this.Pos);\r\n\r\n    let direction = this.Pos.clone().subtract(this.VecY).normalize();\r\n    let distance = math.Vec3.distance(this.VecY, this.Pos);\r\n\r\n    // Lưu trữ hướng di chuyển của stick trước đó\r\n    let lastDirection;\r\n    if (stickMag > 0) {\r\n        lastDirection = direction;\r\n    }\r\n\r\n    // Nếu không có sự kiện di chuyển, sử dụng hướng di chuyển trước đó\r\n    if (stickMag === 0 && lastDirection) {\r\n        direction = lastDirection;\r\n    }\r\n    let posX = this.plane.position.x + direction.x * distance * 0.05;\r\n    let posY = this.plane.position.y + direction.y * distance * 0.05;\r\n\r\n\r\n    // Cập nhật vị trí của mặt phẳng\r\n    if (posX >= -630 && posX <= 630 && posY >= -330 && posY <= 330) {\r\n        this.plane.setPosition(new Vec3(posX, posY));\r\n    } else {\r\n        return;\r\n    }\r\n    }\r\n    onStickEnd(event: EventTouch){\r\n        this.Stick.setPosition(new Vec3(0, 0));\r\n    }\r\n}\r\n\r\n\r\n"]}