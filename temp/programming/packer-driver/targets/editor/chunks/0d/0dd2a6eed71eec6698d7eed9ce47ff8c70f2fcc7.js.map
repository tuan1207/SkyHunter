{"version":3,"sources":["file:///D:/Cocos%20Creator/Sky-Hunter/NewProject/assets/scripts/JoyStick.ts"],"names":["_decorator","Component","math","Node","UITransform","Vec3","Plane","ccclass","property","JoyStick","Pos","VecY","angleDeg","start","update","deltaTime","countAngleStick","console","log","onLoad","instance","Stick","setPosition","node","on","EventType","TOUCH_MOVE","onStickMove","TOUCH_END","onStickEnd","TOUCH_CANCEL","event","wp","getUILocation","getComponent","convertToNodeSpaceAR","x","y","stickMag","length","maxR","angleInRadians","Math","acos","dot","toDegree","planeMoveByJoyStick","dt","moveRight","moveUp","planeMove"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAuBC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;;AAC5DC,MAAAA,K,iBAAAA,K;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;0BAGjBS,Q,WADZF,OAAO,CAAC,UAAD,C,UAGHC,QAAQ,CAACL,IAAD,C,sCAHb,MACaM,QADb,SAC8BR,SAD9B,CACwC;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAM7BS,GAN6B;AAAA,eAO7BC,IAP6B,GAOtB,IAAIN,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,CAPsB;AAAA,eAQ7BO,QAR6B;AAAA;;AAUpCC,QAAAA,KAAK,GAAG,CAEP;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,eAAKC,eAAL;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKR,GAAjB;AACH;;AACSS,QAAAA,MAAM,GAAS;AACrBV,UAAAA,QAAQ,CAACW,QAAT,GAAoB,IAApB;AACA,eAAKC,KAAL,CAAWC,WAAX,CAAuB,IAAIjB,IAAJ,CAAS,CAAT,EAAY,CAAZ,CAAvB;AACA,eAAKkB,IAAL,CAAUC,EAAV,CAAarB,IAAI,CAACsB,SAAL,CAAeC,UAA5B,EAAwC,KAAKC,WAA7C,EAA0D,IAA1D;AACA,eAAKJ,IAAL,CAAUC,EAAV,CAAarB,IAAI,CAACsB,SAAL,CAAeG,SAA5B,EAAuC,KAAKC,UAA5C,EAAwD,IAAxD;AACA,eAAKN,IAAL,CAAUC,EAAV,CAAarB,IAAI,CAACsB,SAAL,CAAeK,YAA5B,EAA0C,KAAKD,UAA/C,EAA2D,IAA3D;AACH;;AACDF,QAAAA,WAAW,CAACI,KAAD,EAAmB;AAC1B,cAAIC,EAAE,GAAGD,KAAK,CAACE,aAAN,EAAT;AACA,eAAKvB,GAAL,GAAW,KAAKa,IAAL,CAAUW,YAAV,CAAuB9B,WAAvB,EAAoC+B,oBAApC,CAAyD,IAAI9B,IAAJ,CAAS2B,EAAE,CAACI,CAAZ,EAAeJ,EAAE,CAACK,CAAlB,CAAzD,CAAX;AACA,cAAIC,QAAQ,GAAG,KAAK5B,GAAL,CAAS6B,MAAT,EAAf;;AACA,cAAGD,QAAQ,IAAI,CAAf,EAAiB;AACb;AACH;;AACD,cAAGA,QAAQ,GAAG,KAAKE,IAAnB,EAAwB;AACpB,iBAAK9B,GAAL,CAAS0B,CAAT,GAAa,KAAK1B,GAAL,CAAS0B,CAAT,GAAa,KAAKI,IAAlB,GAAuBF,QAApC;AACA,iBAAK5B,GAAL,CAAS2B,CAAT,GAAa,KAAK3B,GAAL,CAAS2B,CAAT,GAAa,KAAKG,IAAlB,GAAuBF,QAApC;AACH;;AACD,eAAKjB,KAAL,CAAWC,WAAX,CAAuB,KAAKZ,GAA5B;AACH;;AACDmB,QAAAA,UAAU,CAACE,KAAD,EAAmB;AACzB,eAAKV,KAAL,CAAWC,WAAX,CAAuB,IAAIjB,IAAJ,CAAS,CAAT,EAAY,CAAZ,CAAvB;AACH;;AACDW,QAAAA,eAAe,GAAE;AACb,gBAAMyB,cAAc,GAAGC,IAAI,CAACC,IAAL,CAAU,KAAKhC,IAAL,CAAUiC,GAAV,CAAc,KAAKlC,GAAnB,KAA2B,KAAKC,IAAL,CAAU4B,MAAV,KAAqB,KAAK7B,GAAL,CAAS6B,MAAT,EAAhD,CAAV,CAAvB;AACA,eAAK3B,QAAL,GAAgBV,IAAI,CAAC2C,QAAL,CAAcJ,cAAd,CAAhB;AACH;;AACDK,QAAAA,mBAAmB,CAACC,EAAD,EAAY;AAC3B,cAAG,KAAKrC,GAAL,CAAS0B,CAAT,GAAa,CAAb,IAAkB,KAAK1B,GAAL,CAAS2B,CAAT,GAAa,CAA/B,IAAoC,KAAK,KAAKzB,QAA9C,IAA0D,KAAKA,QAAL,GAAgB,EAA7E,EAAgF;AAC5E;AAAA;AAAA,gCAAMQ,QAAN,CAAe4B,SAAf;AACA;AAAA;AAAA,gCAAM5B,QAAN,CAAe6B,MAAf;AACA;AAAA;AAAA,gCAAM7B,QAAN,CAAe8B,SAAf,CAAyBH,EAAzB;AACH;AACJ;;AAnDmC,O,UAC7B3B,Q;;;;;iBAEc,I;;+EACpBZ,Q;;;;;iBACqB,G","sourcesContent":["import { _decorator, Component, EventTouch, math, Node, UITransform, Vec3 } from 'cc';\r\nimport { Plane } from './Plane';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('JoyStick')\r\nexport class JoyStick extends Component {\r\n    static instance: JoyStick;\r\n    @property(Node)\r\n    public Stick: Node = null;\r\n    @property\r\n    public maxR: number = 100;\r\n    public Pos;\r\n    public VecY = new Vec3(1, 0, 0);\r\n    public angleDeg;\r\n    \r\n    start() {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        this.countAngleStick();\r\n        console.log(this.Pos);\r\n    }\r\n    protected onLoad(): void {\r\n        JoyStick.instance = this;\r\n        this.Stick.setPosition(new Vec3(0, 0));\r\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onStickMove, this);\r\n        this.node.on(Node.EventType.TOUCH_END, this.onStickEnd, this);\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onStickEnd, this);\r\n    }\r\n    onStickMove(event: EventTouch){\r\n        let wp = event.getUILocation();\r\n        this.Pos = this.node.getComponent(UITransform).convertToNodeSpaceAR(new Vec3(wp.x, wp.y));\r\n        let stickMag = this.Pos.length();\r\n        if(stickMag <= 0){\r\n            return;\r\n        }\r\n        if(stickMag > this.maxR){\r\n            this.Pos.x = this.Pos.x * this.maxR/stickMag;\r\n            this.Pos.y = this.Pos.y * this.maxR/stickMag;\r\n        }\r\n        this.Stick.setPosition(this.Pos);\r\n    }\r\n    onStickEnd(event: EventTouch){\r\n        this.Stick.setPosition(new Vec3(0, 0));\r\n    }\r\n    countAngleStick(){\r\n        const angleInRadians = Math.acos(this.VecY.dot(this.Pos) / (this.VecY.length() * this.Pos.length()));\r\n        this.angleDeg = math.toDegree(angleInRadians);\r\n    }\r\n    planeMoveByJoyStick(dt: number){\r\n        if(this.Pos.x > 0 || this.Pos.y > 0 || 45 < this.angleDeg || this.angleDeg < 90){\r\n            Plane.instance.moveRight;\r\n            Plane.instance.moveUp;\r\n            Plane.instance.planeMove(dt);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}